<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>{{ title }}</title>
  <link rel="stylesheet" href="{{ url_for('static', filename='style.css') }}">
  <style>
    .topbar {
      display: flex;
      align-items: center;
      justify-content: space-between;
      padding: 10px;
      background: #111;
      color: #fff;
    }
    .topbar .title {
      font-size: 16px;
      display: flex;
      align-items: center;
      gap: 8px;
    }
    .topbar .title img {
      width: 28px;
      height: 28px;
      border-radius: 50%;
      border: 1px solid #444;
    }
    .controls button {
      font-size: 26px;
      background: none;
      border: none;
      color: #fff;
      margin: 0 15px;
    }
    .play-prim {
      font-size: 40px;
      color: #1da1f2;
    }
    .circle {
      font-size: 20px;
      background: none;
      border: none;
      color: #ccc;
      transition: 0.2s;
    }
    .circle.active {
      color: red;
    }
    .bottom-nav {
      display: flex;
      justify-content: space-around;
      padding: 12px;
      background: #111;
    }
    .nav-item {
      text-align: center;
      font-size: 14px;
      color: #ccc;
      text-decoration: none;
      display: flex;
      flex-direction: column;
      align-items: center;
      gap: 4px;
    }
    .nav-item.active {
      color: #1da1f2;
    }
    .nav-item span {
      font-size: 22px;
    }
    .volume-row {
      margin-top: 12px;
      display: flex;
      align-items: center;
      justify-content: center;
      gap: 15px;
    }
    .volume-control {
      display: flex;
      align-items: center;
      gap: 8px;
    }
  </style>
</head>
<body class="mobile dark">
  <header class="topbar">
    <button class="back-btn" onclick="location.href='/'">‚Üê</button>
    <div class="title">
      <img src="https://graph.org/file/38652f7c83abd11b039c0-1d0a46d1e4e762cbc6.jpg" alt="avatar">
      Now Playing
    </div>
  </header>

  <main class="player-screen">
    <div class="album-wrap">
      <img id="player-thumb" class="album-large" src="{{ thumb }}" alt="Album">
    </div>

    <div class="track-info">
      <div class="track-title" id="title">{{ title }}</div>
      <div class="track-artist" id="artist">{{ artist }}</div>
    </div>

    <div class="progress">
      <span id="current">0:00</span>
      <input id="seek" type="range" min="0" max="100" value="0" />
      <span id="total">0:00</span>
    </div>

    <div class="controls">
      <button class="ctrl">‚èÆ</button>
      <button id="playBtn" class="play-prim" onclick="togglePlay()">‚èµ</button>
      <button class="ctrl">‚è≠</button>
    </div>

    <!-- Volume + Fav + Repeat in one line -->
    <div class="volume-row">
      <div class="volume-control">
        <div style="font-size:14px;color:var(--muted)">Vol</div>
        <input type="range" id="volume" min="0" max="1" step="0.05" value="1" oninput="setVolume(this.value)">
      </div>
      <button id="favBtn" class="circle" onclick="toggleFav()">‚ô°</button>
      <button id="repeatBtn" class="circle">‚Üª</button>
    </div>

    <audio id="audio" preload="auto" src="{{ audio_url }}"></audio>
  </main>

  <div class="nav-bar">
    <a href="{{ url_for('home') }}"><img src="/static/img/home.png" alt="Home"></a>
    <a href="{{ url_for('search') }}"><img src="/static/img/search.png" alt="Search"></a>
    <a href="{{ url_for('profile') }}"><img src="/static/img/profile.png" alt="Profile"></a>
    <a href="{{ url_for('settings') }}"><img src="/static/img/settings.png" alt="Settings"></a>
  </div>

  <script>
    const audio = document.getElementById('audio');
    const playBtn = document.getElementById('playBtn');
    const favBtn = document.getElementById('favBtn');
    const repeatBtn = document.getElementById('repeatBtn');

    // toggle play/pause
    function togglePlay() {
      if (audio.paused) {
        audio.play().then(() => {
          playBtn.textContent = '‚è∏';
        }).catch(() => {
          playBtn.textContent = 'üíø';
        });
      } else {
        audio.pause();
        playBtn.textContent = '‚èπÔ∏è';
      }
    }

    // volume
    function setVolume(value) {
      audio.volume = parseFloat(value);
      localStorage.setItem('player_volume', audio.volume);
    }

    // progress
    audio.addEventListener('timeupdate', () => {
      const cur = Math.floor(audio.currentTime);
      const total = Math.floor(audio.duration || 0);
      function fmt(s) { return Math.floor(s/60) + ':' + String(s%60).padStart(2,'0'); }
      document.getElementById('current').textContent = fmt(cur);
      document.getElementById('total').textContent = fmt(total);
      const seek = document.getElementById('seek');
      if (total > 0) seek.value = Math.floor((audio.currentTime / audio.duration) * 100);
    });

    document.getElementById('seek').addEventListener('input', function(){
      if (!audio.duration) return;
      audio.currentTime = (this.value / 100) * audio.duration;
    });

    // fav toggle
    function toggleFav() {
      favBtn.classList.toggle("active");
      favBtn.textContent = favBtn.classList.contains("active") ? "‚ù§Ô∏è" : "‚ô°";
    }

    // repeat toggle
    repeatBtn.addEventListener("click", () => {
      if (audio.loop) {
        audio.loop = false;
        repeatBtn.classList.remove("active");
      } else {
        audio.loop = true;
        repeatBtn.classList.add("active");
      }
    });

    // restore volume
    const savedVol = localStorage.getItem('player_volume');
    if (savedVol !== null) {
      audio.volume = parseFloat(savedVol);
      document.getElementById('volume').value = audio.volume;
    }
  </script>
</body>
</html>
